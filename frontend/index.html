<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Financial Analytics System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        h1 { color: #2c3e50; }
        input, select, button {
            margin: 5px 0;
            padding: 8px;
            font-size: 14px;
        }
        button { cursor: pointer; }
        #output {
            margin-top: 20px;
            white-space: pre-wrap;
            background: #f5f5f5;
            padding: 10px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>Financial Analytics System</h1>

    <h2>1. Dataset Upload</h2>
    <input type="file" id="datasetFile">
    <button onclick="uploadDataset()">Upload Dataset</button>

    <h2>2. Analytics</h2>
    <label>State:</label>
    <input type="text" id="stateInput" placeholder="California">
    <button onclick="getAnalyticsState()">Analytics by State</button>
    <br>
    <label>City:</label>
    <input type="text" id="cityInput" placeholder="Los Angeles">
    <button onclick="getAnalyticsCity()">Analytics by City</button>
    <br>
    <label>Product:</label>
    <input type="text" id="productInput" placeholder="Desk Chair">
    <button onclick="getAnalyticsProduct()">Analytics by Product</button>

    <h2>3. Prediction</h2>
    <label>Product:</label>
    <input type="text" id="predProduct" placeholder="Desk Chair">
    <label>Quantity:</label>
    <input type="number" id="predQuantity" placeholder="10">
    <button onclick="predictSales()">Predict Sales</button>

    <h2>Output</h2>
    <div id="output">Results will appear here...</div>

    <script>
        async function uploadDataset() {
            const fileInput = document.getElementById("datasetFile");
            const file = fileInput.files[0];
            if (!file) {
                alert("Please select a file first.");
                return;
            }
            const formData = new FormData();
            formData.append("file", file);

            const res = await fetch("/dataset/upload", { method: "POST", body: formData });
            const data = await res.json();
            document.getElementById("output").innerText = JSON.stringify(data, null, 2);
        }

        async function getAnalyticsState() {
            const state = document.getElementById("stateInput").value;
            const res = await fetch(`/analytics/state?state=${encodeURIComponent(state)}`);
            const data = await res.json();
            document.getElementById("output").innerText = JSON.stringify(data, null, 2);
        }

        async function getAnalyticsCity() {
            const city = document.getElementById("cityInput").value;
            const res = await fetch(`/analytics/city?city=${encodeURIComponent(city)}`);
            const data = await res.json();
            document.getElementById("output").innerText = JSON.stringify(data, null, 2);
        }

        async function getAnalyticsProduct() {
            const product = document.getElementById("productInput").value;
            const res = await fetch(`/analytics/product?product=${encodeURIComponent(product)}`);
            const data = await res.json();
            document.getElementById("output").innerText = JSON.stringify(data, null, 2);
        }

        async function predictSales() {
            const product = document.getElementById("predProduct").value;
            const quantity = Number(document.getElementById("predQuantity").value);

            const res = await fetch("/prediction/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ product, quantity })
            });

            const data = await res.json();
            document.getElementById("output").innerText = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>
